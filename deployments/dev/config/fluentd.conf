<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

<filter s3.access.**>
  @type record_transformer
  <record>
    event_type ${record["api"] == "PutObject" ? "put" : record["api"] == "GetObject" ? "get" : record["api"] == "DeleteObject" ? "delete" : "unknown"}
    bucket_name ${record["bucket"]}
    object_key ${record["key"]}
    user_id ${record["accessKey"]}
    timestamp ${time}
  </record>
</filter>

<match s3.access.**>
  @type nats
  host nats
  port 4222
  subject safebucket-bucket-events
  <buffer>
    @type memory
    flush_interval 1s
  </buffer>
</match>
